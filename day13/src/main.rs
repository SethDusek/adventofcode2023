const INPUT: &'static str = "##..#..#......#
.........#..#..
.####.#.######.
#....#.###..###
..##..#.#.##.#.
######...#..#..
#.##.#.#.#..#.#
#....#..######.
.#..#...#.##.#.
#....#....##...
.#..#.#..####..
......#.######.
##..##.#.####.#

.#...##..
..##.#.##
.#.###...
###..#.##
##.#.####
..#.#..##
.###...##
.#...#.##
#####.#..
...#..###
###.##.##
####...##
####..###
###.##.##
...#..###

#####...####.#.
##..###..#..#.#
...#.###.....#.
...#.###.....#.
##..###..#..#.#
#####...####.#.
##....####.....
#..##.....#..#.
#..##.....#..#.
##....####.....
#####...######.
##..###..#..#.#
...#.###.....#.

#..##...#
#..#..###
#..#..###
#..##...#
.##..#.#.
.....###.
#..#.##.#
...#..###
.##.#..##
.##.#.#.#
#####.#..

######.#.#.#...
.#..#.#.##...#.
...#....#.#.#..
#.##.#.#.....#.
.......##.#.###
#######.##.#..#
......##...##..
#.##.#....#.#..
#.##.#....#.#..

#...#..##..
.##..######
....###..##
.#..#..##..
.####.####.
###.##....#
.#..##...##
###.#..##..
#.#.#......
.####......
....#.####.
..##..#..#.
..#.#.####.
..#.#.####.
..##..#..#.

#...#.#.##.#.#...
###.#..#..#..#.##
#...##.####.##...
#.....#.##.#.....
...#####..#####..
##..#.######.#..#
###.##.#..#.##.##
...#..#.##.#..#..
....#........#...
#..##.#.##.#.##..
#................

...##.###.#
...##.###.#
##..#....#.
##.....#.##
#.##..#.#.#
..##...#.#.
...#####..#

.##.##.#.##..
#..#.#.#.....
####.###..#.#
####.####.###
#..#.#####.##
#..#.#....###
#..#.#....###
#..#.#####.##
####.####.###
####..##..#.#
#..#.#.#.....
.##.##.#.##..
.....##.#.#..
####..#.#.##.
#####.#...###
#####.#...#..
#..#...####.#

#..#.#...#...##..
...#...#..#..##..
#..####.#.#.####.
..#####..#.##..##
..#...####.##...#
.#.#########....#
.#.#########....#

#..#...#.#.#...#.
#.####...###.#.#.
#.....##...##.#.#
##.##....#....#..
#.....##....#....
..##.##.#...#..#.
..##.##.#...#..#.
#.....##....#....
##.##....#....#..
#.....##...##.#.#
#.####...###.#.#.
#..#...#.###...#.
......#.#..##....
......#.#..##....
#..#...#.###...#.
#.####...###.#.#.
#.....##...##.#.#

....#..
#.##...
#.###..
#...##.
.##..##
.##..##
#...##.
#.###..
#.##...

##.##.#..
..#..#..#
...#####.
..#....##
##.##.##.
##.##.##.
..#...###
...#####.
..#..#..#

...####.....#####
.#......#.####..#
.#########.##....
####..#####.#####
..######..#...##.
#.##..##.#....##.
....##....##.....
#........#.#.....
....##.....#.....
...#..#.......##.
#.######.##......
.##....##.###.##.
...####...#..#..#

.#...###..###...#
##..##.#....##..#
.#.#.########.#.#
.######.##.######
.##.#...##...#.##
.#...########...#
.#.#...#..#...#.#
#..#....##....#..
#..####.##.####..
#.##..##..##..##.
..#...#.##.#...#.
#..#..........#..
#..#..........#..

....#..###....#
#..#..#..#....#
#..##.....####.
.##..#..#..##..
####.###..####.
###.#.##.#.##.#
.##..#..##....#
#####.###..##..
####..#...#..#.
#..#....#..##..
#..####..##..##
......#.##.##.#
.##...#########
.........#.##.#
.##..######..##
#..####..#....#
.##.####..#..#.

#..#.##...#.##.
###.##.##.#...#
##.########.#.#
.#.#.##.#...###
.#.#....####...
.#.#....####...
.#.#.##.#...###
##.########.#.#
###.#..##.#...#
#..#.##...#.##.
#..#.##...#.##.

.##..####..##..
####..##..#####
.#.#.####.#.#..
..##..##..##...
#....#####...##
####.#..#.#####
##..........###
#.#.#....#.#.##
#...##..##...##
.##.##..##.##..
..##..##..##...
....#.##.#.....
###.######.####

########..#.##.#.
######..######.##
#.##.#.#.###.###.
#....#.#.####.###
#....##..#..###..
......##.##..###.
..##..#..#.###..#
..##..#.#.##...#.
##..######..##..#
##..######...#..#
..##..#.#.##...#.
..##..#..#.###..#
......##.##..###.
#....##..#..###..
#....#.#.####.###
#.##.#.#.###.###.
######..######.##

#.####..##..#
#.#.#........
.#.###...#..#
#...#..##....
...#.#.###..#
#..####.#....
#####.#..#..#
.##..####....
.....#...#..#
##.#...#.####
.....###.....
###..##.#....
.#..##.#.####
#...#..#..##.
##...#.......
.#...#.......
#...#..#..##.

...#..##.
..#.#.#.#
######.##
#####.###
..####...
######..#
######..#
..####...
#####.###
######.##
..#.#.#.#
...#..##.
#..###.##
####..##.
...#.#..#
...###.#.
..##.##.#

.####.....#.#
........#.###
##..##...##.#
..##...####..
..##...####..
##..##...##.#
........#.###
.####.....#.#
######.##.#..
.#..#.####.#.
##..####.##.#
#.##.##..#...
##..########.
##..##.##.#.#
.####....#.#.
.....#.#.#.#.
.#..#....#.##

#..########..##
#............##
#.##########.##
.#.#.####.#.#..
##.#......#.###
.#.###..#.#.#..
###.######.####
#.##.####.##.##
##.##....##.###
#.#.#.##.#.#.##
#.##......##.##

.#......#..####.#
#.#.#####.#.###..
##..##.#..#...##.
.##.#..###...#..#
.##.#..###...#..#
##..##.#..#...##.
#.#.#####.#.###..
.#......#..####.#
#..##.#.##..#.#..
#..##.#.##..#.#..
.#.....##..####.#
#.#.#####.#.###..
##..##.#..#...##.

.#....#......#.
..#.##.######.#
...#.#..#..#..#
##..#.###..#.#.
##.............
##..#.########.
..#.##..####..#
..#.##..####..#
##..#.########.
##.............
##..#.###..#.#.

####.##
###..##
#.#####
##..#..
#......
####.##
#.#....
..###..
..#####
#.#....
####.##
#......
##..#..
#.#####
###..##
####.##
#####..

###.##.....
##.##..#..#
##.##.....#
###.##.....
#####...#..
..#########
########.##
##.###...##
..#..#..#.#
..##...##..
...####.#.#

#.##...#....#
##....##....#
##..##..#..#.
##..##..#..#.
##.....#....#
#.##...#....#
.##.....####.
#####..#.##.#
#.####.#.##.#
.#.##.#.#..#.
#...#.#..##..
###..##.####.
.#####.......

#..##.#
#.###..
#.###..
#..##.#
.##.##.
...#...
#..###.
#..##..
#..#..#
#..#..#
#..##..
#..###.
.#.#...

.###.##
.##.###
##.....
##..#..
.##.###
.###.##
#...###

..##..#.##.
.#..#.....#
.#..#.##.#.
######.####
..##.......
..##.......
######.####
.#..#.##.#.
.#..#.....#
..##..#.##.
#........#.
########..#
##..##..##.

..######.....#...
...........##.##.
.#.####.#....####
.#..##..#.####..#
####..#####......
###########.#.##.
.#..##..#..###..#
###.##.###...####
#..####..##.#####

###.#####..##..
...........##..
.#.##...#..##..
.#...##.##....#
.....#.###.##.#
..#####..#....#
##..###..##..##
####.##...#..#.
.#.##..##.#..#.
.####...##.##.#
...#.##..######
..#..##..######
..#..###..####.
..#..###..####.
..#..##..######
.#.#.##..######
.####...##.##.#

..##.##..#.....
..##.##..#.....
.##...##.##...#
.....##..##.##.
#####.####..##.
.#......#.##..#
....##..###.##.

#..####
##.##..
..#.#..
..#.#.#
..#...#
.....#.
.#.#...
.#.#...
.....#.
..#...#
..#.#.#

#.###.#
#####.#
.##..#.
.##..#.
#####.#
#.###.#
...####
.#.##.#
......#

#.##..##.####.#
..######..##..#
###....###..###
...####...##...
#........####..
###.######..###
##.####.##..##.
##..##..######.
.#......#.##.#.
#.#....#.####.#
##......######.
..#....#..##..#
###.##.########
.#......#.##.#.
.#......#....#.

.##........#.
...#.##.##..#
.#..###..####
...#.....####
.#....##..###
#..#...#.#...
#.#...#.##.#.
#.#...#.##.#.
#..#...#.#...
##....##..###
...#.....####
.#..###..####
...#.##.##..#
.##........#.
.##........#.
...#.##.##..#
.#..###..####

....##....###
.########....
##.#..#..####
#...##...##..
#........#.##
###.##.####..
..##..##..###
..#....#.....
#..####..####
##.####.##.##
##..##..##.##

########.#.#.##.#
###..####.##....#
##....##...##..##
#......#.########
#.####.##.##.##.#
#......##.#.#....
#......##....##..
.######.##.......
##....####.#.##.#
#..##..#.###....#
...##...#....##..
.######....######
##.##.##.#...##..
#..##..#.#.##..##
.#....#.##...##..

###.#...####...#.
#..#.##..##..##.#
.##...##....##...
#####......#...##
#####......#...##
.##...##....##...
#..#.##..##..##.#

####..#.##.#.
.#..##.####.#
#..#.#.####.#
#..#.#.####.#
.#..##.####.#
####..#.##.#.
.###.#.####.#
##....#......
####.#..##..#
##..#...##...
...##.#....#.
##.##########
###.####..###

#..######..#...
.###....###..##
.#.####.#.#..##
.###.##.###..##
..###..###..###
.#...##...#..##
###.#..#.###...
#.#.#..#.#.##..
#..######..##..
...#.##.#...###
..#......#.....

......##.#.
##.#..#....
##.#..#....
......##.#.
#.#.#.##.#.
..#.#.###.#
#####..##..
##.###.#..#
..#.##...#.

##......###.###
##......###.###
#.##..##.##..#.
.##....##.###.#
..........#.#.#
..######...#..#
##.####.##...#.
..#....#..##..#
.###..###..##.#
.#......#.##.#.
.#......#.##..#
.#.####.#..#..#
###.##.######..
##..##..#.#....
.##.##.##...##.

.#....#.#..#.
...##....##..
##.##.##....#
#.#..#.#.##.#
.######..##..
###..####..##
##.##.###..##
..#..#..#..#.
.#.####.#..#.
.#....#......
#..##..##..##
.#....#..##..
###..###....#

##.##.##.###....#
.######.####....#
#......##.##.#..#
..#..#..##.##..##
.#....#..#.#.##.#
#..##..#..#######
..#..#...##.#..#.
...##.....#######
#.####.#.#.##..##
##....#######..##
.######..##.#..#.
.##..##..#..#..#.
###..####...#..#.
.#.##.#..#.#....#
.######.#.###..##
.........####..##
##.##.##.........

....##.##.#.#..##
####.##.###.####.
#..##..#.####..##
.##....##.#.##.##
#..#...#.#.##....
.##......##..#.##
#..#.##...#.#.#..

....##.##
....##.##
....#....
..###.#..
##.#.####
....#.#..
..#......
###....#.
#...#.#.#

.....##...###.#.#
.##.#.##.....#...
.##.#.##.....#...
.....##...###.#.#
#.######...###...
..#.#....#.##.#.#
##########.#..#.#
..#..#....###..#.
...##.#.##..###..
#####.#.......##.
..#..#.#.#...##.#
..#..#.#.#...##.#
#####.#...#...##.
...##.#.##..###..
..#..#....###..#.

.#.##.#.....#....
#.#..#.#.#.##.#.#
###..####......##
#.####.#..#..#..#
..#..#..###..###.
..####.....##....
##....####....###

##..#.##......#
..#.##.#.##.###
#..#......#.###
.##.##.#.....#.
#.#..##.##.##.#
#.#..##.##.##.#
.##.##.#.....#.
#..#......#.###
#.#.##.#.##.###
##..#.##......#
#....###.##.#..
#....###.##.#..
##..#.##......#
#.#.##.#.##.###
#..#......#.###

..##.#...#.##
.#.##.#..#...
#..##..##..##
#......###...
...........##
.#.##.#.###..
#.#..#.###...
.#.##.#.##.##
##....##.####
.#.##.#....##
##.##.##..#..
#.####.#.####
#.####.#.#.##
.#....#.##.##
..#..#..##.##
#..##..##....
#......#.#.##

..#..###.....
.##.#.#...#.#
..######.#.#.
...#####.#.#.
.##.#.#...#.#
..#..###.....
#..#######...
.#..#.#......
..####.#..#..
...#..##.####
.####.......#
#...#.##..#.#
...####.##.##
...####.##.##
#...#.##..#.#

...###.
.#..###
.#..###
...###.
..#.#..
.###..#
..#.#.#
.#.#.#.
.###..#
.###..#
.#.#.#.
#.#.#.#
.###..#
..#.#..
...###.

..######.....
##########..#
...####......
#.######.#..#
#..#..#..#..#
#.##.###.#..#
##..##..##..#
##.####.##..#
##.####.#####
#.#.##.#.#..#
.#..##..#.##.
#...##...####
..######.....
##.####.##..#
..........##.

##.##.###.#......
#..##..#.#..####.
#......###.#....#
#########.##....#
...##.....#######
#..##..#..#......
#......####.#..#.
#..##..#..#......
.##..##.#..#.##.#
..#..#...#.##..##
...##....#####.##
##########.#....#
##.##.#####..##..
#.####.######..##
###..#######.##.#
#......#..#.#..#.
..#..#......####.

.#..##.##..###.
.#.###.##..###.
#...#...#####..
...##.####...##
....#.#####.#.#
##.#..#.###.#..
.#.##.####..##.
##.#...##.##.#.
....######.####
....#.#.##..###
..##...#......#
#####...####.##
#####...####.##
..##...#......#
....#.#.##..###
....######.####
##.#...##.##.#.

#..##.###
.##.....#
.##.##..#
###..####
#####.#.#
......#.#
#..##.#..
#..##.#..
......#.#
#####.#.#
###..####
.##.##..#
.##.....#
#..##.###
#..######

..#.#.#..#.#.
..#.#.#..#.#.
#...#.#..#.#.
.###.#..#..#.
.#.#..#.#.#..
#.....#...###
##.##.#####..
##.##.#####..
#.....#...###
.#.##.#.#.#..
.###.#..#..#.

####...#.#.
####...#.#.
#..#..#..##
.....#..###
#..#.#..###
.........#.
.....###.##
######.#...
#..##.###.#
.........#.
..#..#.#.#.
#######.##.
####.#..#.#

#..###.
#..###.
.....##
##.#...
#.#.#..
.###.#.
#.##.##
##..##.
..###.#
...###.
.#.###.

############...##
##..####..##.#...
##..####..##.##..
.####..####..#.##
..##....##..##.#.
.####..####.#..#.
..............##.
#..........#.##.#
##############.#.
.#..#..#..#.#.#.#
............#.#.#
..##....##..###..
#....##....#.###.
##############.##
.#..#..#..#.#...#

.##......#.####
....###..###.##
.....######....
....#..##.##...
######....#.###
#..###.##....#.
########.#.###.
#..#####.#..###
.##..#...####..
.##....##..####
#...##.##.###..
.##...#..######
#..#.#.#.#.#...
.##...#..#....#
.##...#..#....#

##.#.##.#.###
.#.##..##.#.#
#.#..##..#.#.
###.#..#####.
#.#.#..#.#.#.
##.######.###
#.##....##.#.
#.##....##.#.
##.######.###

###..#####.##
###..#####.##
.....###..###
...##..###...
##.#.##.##.##
..##.....#.##
#.###........
#...##...##.#
#.####.##.#..
#.#..###.####
.#.#.#####...
#.##.##.##...
####...####..
#####....####
.#.##.##.#...
.##.##..##...
.#.#...##.#..

.###..###
.#.#....#
.#..##..#
.#......#
...#..#..
##..##..#
####..###
##.#..#.#
#.##..##.
#.##..##.
##.#..#.#
####..###
##..##..#

###...#....
...##.#.#.#
..#########
..##....#.#
..#######.#
..#....##..
..#....###.
..#######.#
..##....#.#

####......#...###
#.#..#..##..#..#.
##.##..####..##.#
..###...##...###.
.######....######
..#####....#####.
#.###...##...###.
.#......##......#
...#..######..#..
...#..######..#..
.#......##......#

...#..#.###
##.####....
...##..####
###...#....
..#..#...##
##..#.##...
...##...##.
.......####
####..###.#
.....#.#..#
##....#....
#######.###
##.####.###

#.#..#...
..##..#..
..##..#..
#.#..#...
.####....
##..#.###
...##....
...#...##
..#..####
.#.##...#
....#....

..#####.....##.
#.##..#....##..
........####..#
......#.###..##
....###....##.#
....###....##.#
......#.###..##
........####..#
#.##..#....##..
..#####.....##.
.##.#..#.#.#.##
.##.#....#.#.##
..#####.....##.

.#.#.#.##
.#.###.##
.##...#..
##.##.##.
##.#..#..
..#..#.#.
##.#.#.##
##.#.#.##
..#..#.#.

..#.#####
##...#..#
##.###..#
######..#
##...#..#
..#.#####
.#.#.....
#.....##.
...#.####
####.####
##.......
#..#.#..#
...##.##.
#.#.##..#
###......
....#####
..##..##.

...##...#
...######
...##....
###..#.##
##.#.#.##
.#...#.#.
..#.#.###
.....##..
###.#....
##.#.#.#.
##.#.#.#.

....#.....#..
#..##.#....#.
##...........
..##.##...##.
.###..#..###.
##.########.#
##..###....##
###.##..#.##.
###.##..#.##.
##..###....##
##.########.#
.###.....###.
..##.##...##.
##...........
#..##.#....#.
....#.....#..
....#.....#..

..##.#.#.
#####.#..
#...####.
##.###...
##....#.#
##.#.#...
...#####.
##..#...#
.....###.
###..##.#
###.#.###
###.#.###
###..##.#

..#.###
.....#.
..#...#
..#..##
####.##
###.#.#
###.#..
####.##
..#..##
..#...#
.....#.

.###.#.#.##.#..
#.####..##..#.#
#.####..##..#.#
.###.#.#.#..#..
....#...#..##.#
..####.##.#...#
##..#.#..#..##.
###..#...#.....
###..#...#.....

#...#.....##.
#.###.#..####
..###.######.
.#..####..##.
.#..####..##.
..###.######.
#.###.#..####
#.........##.
.##.##.###...
#.##..#####..
##..######..#
###.#...#....
.#.#.########
###......###.
....######.#.
.###.##.##.#.
.###.##.##.#.

#..#..#....#..#
..###.#.##.#.##
##.###......###
##...########..
.....#.........
#...###....###.
#...###....###.

.#..#....#..#..
#....#..#####..
.####.###..##..
#....#####.##..
..##.......#.##
.......#.##..##
##..###..###...
.###....#.#.#..
.#..#...##.....
#....#..##.####
##..###.####.##
..##..#...#.#..
.........#..###

.####..
#...#.#
..##..#
#..###.
#..###.
#.##..#
#...#.#
.####..
..##.##
..##...
#....#.
#.#..#.
#.#..#.

#####...#..##
#.###...#..##
.#####.#.#...
.##.##..#####
....##.###...
..#.#.###.###
.##....##..##
##..#.###.###
##...###.#...
.#.##.#.#..##
.#.#...#.####
#....#...#...
...##..##..##

.....#.#.....
....##.......
#..#.#.##....
#####.##.....
#....####.##.
#..####...##.
#..###.#..##.
....##..#####
#####.###....
....#.###....
####.#...#..#
#######......
....#.##.####
.##....#.#..#
....###.##..#

##.####......##.#
....#.###.#...##.
....#.###.#...##.
##.####......##.#
.##..#.##...#.###
.#.#.#...#...#...
#.##.#..##.#.#.#.
#.##.#.###.#.#.#.
.#.#.#...#...#...

#####..####..####
...###..##..###..
..##..........##.
##.#..##..##..#.#
##....#.##.#....#
##.#.#..###.#.#.#
..#.###....###.#.
..##..........##.
..###...##...###.
....#.##..##.#...
.....#......#....

.####..#..#..##
..##...#..#....
......###...###
......##.##..#.
#....#.#.#.#...
######.###...##
.####.#.#..##.#
.......#.#..#..
.......#.#..#..
.####.#.#..##.#
######.###...##
#....#.#.#.#...
......##.##.##.

#.#..##.#.#..
.#..##..#..##
.#..##..#..##
#.#..##.#.#..
..#..#...#.#.
.#...#.#.###.
#.#####.#.##.
#...#...#.#..
#...#...#.#..
#.#####.#.##.
.#...#.#.###.
..#..#...#.#.
#.#..##.#.##.

#..##......##..#.
#..##......##..#.
.#.#.#.##.#.#.#.#
#..#.######.#..##
.#..##.##.##..#.#
#...#..##..#...#.
#.############.#.
#..##.#..#.##..##
#..###....###..##
##.#...##..##.###
.##.##....##.##..

..###.#.##.#.###.
.##.##..##..##.##
.##.##..##..##.##
..###.#.##.#.###.
.##..#.####.#..##
###.##..##..##.##
###.#.#.##.#.#.##
.#..............#
#...###.##.###.#.
###...#....#...##
.##..#..##..#..##
..#..##....##..#.
..#.#.######.#.#.
###..##.##.##..##
..#..#.#..#.#..#.

###.##.##
##..##..#
#.######.
#.######.
##..##..#
###.##.##
.###..###
#.#....#.
..#.##.##

....#.##..#
......#.##.
#.####.#..#
#.####.#..#
......#.##.
....#.##..#
.#.##.#..#.
.##..##....
#....##.##.

.##...##.#.
.#.##...##.
#..#####.##
#..#####.##
.#.##...##.
.##...##.#.
.#..###...#
###.##.##.#
#...##.#.##
#...##.#.##
.##.##.##.#
.#..###...#
.##...##.#.

.##...##.
.##...##.
##..###.#
##.#.#..#
.....#...
#..#.##.#
........#
..##.###.
..##.###.
........#
#..#.##.#
.#...#...
##.#.#..#
##..###.#
.##...##.

####..#..##.##.##
....#.##.........
....#...#.######.
.....##..##....##
.....####........
####..#...##..##.
....###.##.#..#.#
#####.....##..##.
.##.....#...##...
.##.##.#..######.
#..#####..#.##.#.
#..######.##..##.
..#.#.#.#.######.
.##...#..##.##.##
####..####.####.#

#...#.#
#..#.##
##..###
##..##.
#..#.##
#...#.#
.#....#
#..##.#
...#.#.
###...#
##..###
.#####.
.#####.
##..###
###...#

##.##..##.##.#..#
.##..##..#..##..#
#############...#
....#..#........#
#..##..##..#.##..
#..#....#..######
#....##....###.##
###.####.#####..#
.#..####..#.#.###
##..#..#..###..#.
..##.##.##...##.#
.##..##..##.....#
...............#.
...............#.
.##..##..##.....#
..##.##.##...##.#
##..#..#..###..#.

#.#######
##.#...##
#..##..##
#..#.##..
##.##..##
###.#####
###.#####
##.##..##
#..#.##..
#..##..##
##.#...##
#.#######
..#.#.#..
#...#.##.
.#.#..#..
.#.##..##
#.#..####

.......#.#...####
....#..#....#.##.
..##...#...######
##.#....#.##.####
##..##...#####..#
.##...#####.#####
.####..##.#...##.
#..#..#####..#..#
#..#..#####..#..#
.####..##.#...##.
.##...#####.#####
##..###..#####..#
##.#....#.##.####
..##...#...######
....#..#....#.##.
";
const TEST: &'static str = "#.##..##.
..#.##.#.
##......#
##......#
..#.##.#.
..##..##.
#.#.##.#.

#...##..#
#....#..#
..##..###
#####.##.
#####.##.
..##..###
#....#..#";

fn symmetric_vertical<T: AsRef<str>>(grid: &[T], mut l: usize, mut r: usize) -> bool {
    let mut all = true;
    loop {
        for row in 0..grid.len() {
            if grid[row].as_ref().bytes().nth(l) != grid[row].as_ref().bytes().nth(r) {
                all = false;
                break;
            }
        }
        if l == 0 {
            break;
        }
        l = l.saturating_sub(1);
        r += 1;
        if r == grid[0].as_ref().len() {
            break;
        }
    }
    all
}
fn symmetric_horizontal<T: AsRef<str>>(grid: &[T], mut l: usize, mut r: usize) -> bool {
    let mut all = true;
    loop {
        for col in 0..grid[0].as_ref().len() {
            if grid[l].as_ref().bytes().nth(col) != grid[r].as_ref().bytes().nth(col) {
                all = false;
                break;
            }
        }
        if l == 0 {
            break;
        }
        l = l.saturating_sub(1);
        r += 1;
        if r == grid.len() {
            break;
        }
    }
    all
}
fn run(input: &'static str) {
    let patterns = input.split("\n\n");
    let mut sum = 0;
    for pat in patterns {
        println!("{pat}");
        let grid = pat.lines().collect::<Vec<&'static str>>();
        let (mut l, mut r) = (0, 1);
        while r < grid[0].len() {
            if symmetric_vertical(&grid, l, r) {
                println!("Vertical Symetry for {l} {r}");
                sum += l + 1;
            }
            l += 1;
            r += 1;
            if r == grid[0].len() {
                break;
            }
        }
        let (mut l, mut r) = (0, 1);
        while r < grid.len() {
            if symmetric_horizontal(&grid, l, r) {
                println!("Horizontal Symetry for {l} {r}");
                sum += 100 * (l + 1);
            }

            l += 1;
            r += 1;
            if r == grid.len() {
                break;
            }
        }
    }
    println!("{}", sum);
}

fn symmetric_vertical2(
    grid: &[String],
    mut l: usize,
    mut r: usize,
) -> Result<bool, Option<(usize, usize)>> {
    let mut all = true;
    let mut count = 0;
    let mut pos = None;
    loop {
        for row in 0..grid.len() {
            if grid[row].bytes().nth(l) != grid[row].bytes().nth(r) {
                all = false;
                count += 1;
                pos = Some((row, l));
            }
        }
        if l == 0 {
            break;
        }
        l = l.saturating_sub(1);
        r += 1;
        if r == grid[0].len() {
            break;
        }
    }
    if all && count == 0 {
        Ok(true)
    } else if !all && count == 1 {
        Err(pos)
    } else {
        Ok(false)
    }
}
fn symmetric_horizontal2(
    grid: &[String],
    mut l: usize,
    mut r: usize,
) -> Result<bool, Option<(usize, usize)>> {
    let mut all = true;
    let mut count = 0;
    let mut pos = None;
    loop {
        for col in 0..grid[0].len() {
            if grid[l].bytes().nth(col) != grid[r].bytes().nth(col) {
                all = false;
                pos = Some((l, col));
                count += 1;
            }
        }
        if l == 0 {
            break;
        }
        l = l.saturating_sub(1);
        r += 1;
        if r == grid.len() {
            break;
        }
    }
    if all && count == 0 {
        Ok(true)
    } else if !all && count == 1 {
        Err(pos)
    } else {
        Err(None)
    }
}
fn run2(input: &'static str) {
    let patterns = input.split("\n\n");
    let mut sum = 0;
    for pat in patterns {
        println!("{pat}");
        let mut grid = pat.lines().map(String::from).collect::<Vec<String>>();
        let (mut l, mut r) = (0, 1);
        let mut smudge_pos = None;
        let mut horizontal_symmetries = vec![];
        let mut vertical_symmetries = vec![];
        while r < grid[0].len() {
            match symmetric_vertical2(&grid, l, r) {
                Ok(true) => {
                    //vertical_symmetries.push((l, r));
                }
                Err(Some(pos)) if smudge_pos == None => {
                    smudge_pos = Some(pos);
                    let new_ch = if grid[pos.0].bytes().nth(pos.1).unwrap() == b'#' {
                        b'.'
                    } else {
                        b'#'
                    };
                    unsafe {
                        grid[pos.0].as_bytes_mut()[pos.1] = new_ch;
                    }
                    vertical_symmetries.push((l, r));
                }
                _ => {}
            }
            l += 1;
            r += 1;
            if r == grid[0].len() {
                break;
            }
        }
        let (mut l, mut r) = (0, 1);
        while r < grid.len() {
            match symmetric_horizontal2(&grid, l, r) {
                Ok(true) => {
                    //horizontal_symmetries.push((l, r));
                }
                Err(Some(pos)) if smudge_pos == None => {
                    smudge_pos = Some(pos);
                    let new_ch = if grid[pos.0].bytes().nth(pos.1).unwrap() == b'#' {
                        b'.'
                    } else {
                        b'#'
                    };
                    println!("Fixing smudge");
                    println!("{}",grid[pos.0]);
                    unsafe {
                        grid[pos.0].as_bytes_mut()[pos.1] = new_ch;
                    }
                    println!("{}", grid[pos.0]);
                    horizontal_symmetries.push((l, r));
                }

                _ => {}
            }

            l += 1;
            r += 1;
            if r == grid.len() {
                break;
            }
        }
        for (l, r) in vertical_symmetries {
            if symmetric_vertical(&grid, l, r) {
                println!("Vertical symmetry for {l} {r}");
                sum+=l + 1;
            }
        }
        for (l, r) in horizontal_symmetries {
            if symmetric_horizontal(&grid, l, r) {
                println!("Horizontal symmetry for {l} {r}");
                sum+=100*(l + 1);
            }
        }
    }
    println!("{}", sum);
}

fn main() {
    //run(TEST);
    //run(INPUT);
    run2(TEST);
    run2(INPUT);
}
